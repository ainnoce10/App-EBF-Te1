-- 1. Activer le Temps Réel (Realtime)
-- Cela permet à l'application de recevoir les mises à jour instantanément
drop publication if exists supabase_realtime;
create publication supabase_realtime for all tables;

-- 2. Création de la table STOCK
create table public.stock (
  id text primary key,
  name text not null,
  category text,
  quantity integer default 0,
  threshold integer default 5,
  "unitPrice" numeric default 0, -- Guillemets pour respecter le camelCase du code TS
  supplier text,
  site text,
  "imageUrls" text[], -- Tableau de liens d'images
  specs jsonb default '{}'::jsonb,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Création de la table INTERVENTIONS (Techniciens)
create table public.interventions (
  id text primary key,
  client text,
  description text,
  technician text,
  status text, -- 'En cours', 'Terminé', etc.
  date date,
  site text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Création de la table TRANSACTIONS (Comptabilité/Caisse)
create table public.transactions (
  id text primary key,
  type text, -- 'Recette' ou 'Dépense'
  category text,
  amount numeric default 0,
  date date,
  description text,
  site text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 5. Création de la table EMPLOYEES (RH)
create table public.employees (
  id text primary key,
  name text,
  role text,
  site text,
  status text, -- 'Actif', 'Congés'
  "entryDate" date, -- Guillemets pour respecter le camelCase
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 6. Création de la table TICKER_MESSAGES (Bandeau TV)
create table public.ticker_messages (
  id bigint generated by default as identity primary key,
  content text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 7. Configuration de la sécurité (Row Level Security)
-- Pour cette démo, nous autorisons l'accès public (lecture/écriture)
-- En production, il faudrait configurer l'authentification.

-- Stock
alter table public.stock enable row level security;
create policy "Public Access Stock" on public.stock for all using (true) with check (true);

-- Interventions
alter table public.interventions enable row level security;
create policy "Public Access Interventions" on public.interventions for all using (true) with check (true);

-- Transactions
alter table public.transactions enable row level security;
create policy "Public Access Transactions" on public.transactions for all using (true) with check (true);

-- Employees
alter table public.employees enable row level security;
create policy "Public Access Employees" on public.employees for all using (true) with check (true);

-- Messages TV
alter table public.ticker_messages enable row level security;
create policy "Public Access Ticker" on public.ticker_messages for all using (true) with check (true);
